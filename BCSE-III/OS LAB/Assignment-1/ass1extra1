#!/bin/bash

# Create the deleted-files directory if it doesn't exist
deleted_files_dir="./deleted-files"
mkdir -p $deleted_files_dir

log_file="logfile.txt"

# Function to log the user actions
log_action() {
    local action=$1
    echo "$USER%$action%$(date)" >> $log_file
}

# Function to display greetings
display_greetings() {
    hour=$(date +"%H")
    if [ $hour -lt 12 ]; then
        greeting="Good morning"
    else
        greeting="Good evening"
    fi
    echo "Hello $USER, $greeting!"
    log_action "Display greetings"
}

# Function to list large files
list_large_files() {
    echo "Enter the minimum file size in bytes:"
    read size
    echo "Files larger than or equal to $size bytes:"
    echo "Filename     Size"
    echo "-------------------"
    find . -type f -size +${size}c -exec ls -lh {} \; | awk '{print $9, $5}'
    log_action "List large files"
}

# Function to display disk usage
disk_usage() {
    echo "Disk usage:"
    df -h
    log_action "Disk usage"
}

# Function to view log file
view_log_file() {
    echo "Log File Content:"
    echo "-------------------"
    if [ -f $log_file ]; then
        cat $log_file
    else
        echo "Log file does not exist."
    fi
    log_action "View log file"
}

# Function to read an existing file
read_file() {
    echo "Enter the file name to read:"
    read file_name
    if [ -f $file_name ]; then
        nano $file_name
        log_action "Read file: $file_name"
    else
        echo "File does not exist."
    fi
}

# Function to remove a file (move to deleted-files)
remove_file() {
    echo "Enter the file name to remove:"
    read file_name
    if [ -f $file_name ]; then
        base_name=$(basename $file_name)
        if [ -f "$deleted_files_dir/$base_name" ]; then
            mv "$deleted_files_dir/$base_name" "$deleted_files_dir/${base_name}.0"
        fi
        mv $file_name "$deleted_files_dir/${base_name}.1"
        echo "File moved to deleted-files directory."
        log_action "Remove file: $file_name"
    else
        echo "File does not exist."
    fi
}

# Function to clear deleted files directory
clear_deleted_files() {
    echo "Are you sure you want to clear the deleted-files directory? (y/n)"
    read confirmation
    if [ "$confirmation" == "y" ]; then
        rm -rf $deleted_files_dir/*
        echo "Deleted-files directory cleared."
        log_action "Clear deleted-files directory"
    else
        echo "Clear operation canceled."
    fi
}

# Main menu loop
while true; do
    echo "Menu:"
    echo "[1] Display greetings"
    echo "[2] List large files"
    echo "[3] Disk usage"
    echo "[4] View Log File"
    echo "[5] Read an existing file"
    echo "[6] Remove an existing file"
    echo "[7] Exit"
    echo "Your choice >"
    read choice

    case $choice in
        1) display_greetings ;;
        2) list_large_files ;;
        3) disk_usage ;;
        4) view_log_file ;;
        5) read_file ;;
        6) 
            echo "Do you want to clear the deleted-files directory? (Use -c to clear it)"
            read -r -p "Enter file name or -c: " input
            if [ "$input" == "-c" ]; then
                clear_deleted_files
            else
                remove_file
            fi
            ;;
        7)
            echo "Exiting..."
            break
            ;;
        *)
            echo "Invalid choice. Please enter a number between 1 and 7."
            ;;
    esac
done

